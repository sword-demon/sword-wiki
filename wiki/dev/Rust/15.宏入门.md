---
id: 宏入门
title: 宏入门
sidebar_position: 15
date: 2022-11-28
tags: [rust, marco]
---

# 宏入门

`Rust`提供了一个强大的宏，可进行元编程(`metaprogramming`)。看起来和函数很想，只不过名称末尾有一个感叹号

之前使用过的一些`println!`、`vec!`和`format!`等是。



>   元编程：用代码生成代码、控制代码、扩展代码
>
>   案例：
>
>   1.   `Java`的注解
>   2.   `php`的`eval`



## 最简单的宏

```rust
macro_rules! me {
    () => {
        println!("无解");
    };
}

fn main() {
    me!();
}

```



在`src`下和`main.rs`同级宏

```rust
macro_rules! echo {
    () => {
        println!("无解");
    };
}
```

```rust
#[macro_use]
mod mymacros;
fn main() {
    echo!();
}

```

:::tip 注意

使用`mod`引用之后，还得加上`#[macro_use]`来使用宏这个注解。

:::

---

加入参数，前面写前缀，后面加上冒号，再加上表达式或者别的

```rust
macro_rules! echo {
    () => {
        println!("无解");
    };
    // 前缀: 表达式
    ($exp: expr) => {
        println!("{}", $exp);
    };
}

```

多个以分号隔开。

```rust
#[macro_use]
mod mymacros;
fn main() {
    echo!();
    echo!("abc");
    let a = 3;
    echo!(a == 3);
}

```

```bash
cargo run
无解
abc
true  # 表达式的结果
```

---

改成使用`stringify!`包裹直接打印出表达式的内容

```rust
macro_rules! echo {
    () => {
        println!("无解");
    };
    // 前缀: 表达式
    // ($exp: expr) => {
    //     println!("{}", $exp);
    // };
    ($exp: expr) => {
        println!("{}", stringify!($exp));
    };
}

```


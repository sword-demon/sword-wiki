"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2148],{3905:(e,n,t)=>{t.d(n,{Zo:()=>f,kt:()=>u});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function p(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?p(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},p=Object.keys(e);for(r=0;r<p.length;r++)t=p[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(r=0;r<p.length;r++)t=p[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=r.createContext({}),c=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},f=function(e){var n=c(e.components);return r.createElement(s.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},i=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,p=e.originalType,s=e.parentName,f=l(e,["components","mdxType","originalType","parentName"]),i=c(t),u=o,m=i["".concat(s,".").concat(u)]||i[u]||d[u]||p;return t?r.createElement(m,a(a({ref:n},f),{},{components:t})):r.createElement(m,a({ref:n},f))}));function u(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var p=t.length,a=new Array(p);a[0]=i;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var c=2;c<p;c++)a[c]=t[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}i.displayName="MDXCreateElement"},5121:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>d,frontMatter:()=>p,metadata:()=>l,toc:()=>c});var r=t(7462),o=(t(7294),t(3905));const p={id:"swoole\u8fdb\u7a0b\u6811",title:"swoole\u8fdb\u7a0b\u6811",sidebar_position:2,data:"2022\u5e7410\u670813\u65e5",tags:["swoole","process"]},a="swoole\u8fdb\u7a0b\u6811",l={unversionedId:"Swoole/swoole\u8fdb\u7a0b\u6811",id:"Swoole/swoole\u8fdb\u7a0b\u6811",title:"swoole\u8fdb\u7a0b\u6811",description:"\u6587\u6863\u5730\u5740",source:"@site/wiki/dev/Swoole/2.swoole\u8fdb\u7a0b\u6811.md",sourceDirName:"Swoole",slug:"/Swoole/swoole\u8fdb\u7a0b\u6811",permalink:"/dev/Swoole/swoole\u8fdb\u7a0b\u6811",draft:!1,tags:[{label:"swoole",permalink:"/dev/tags/swoole"},{label:"process",permalink:"/dev/tags/process"}],version:"current",lastUpdatedBy:"wxvirus",lastUpdatedAt:1665674685,formattedLastUpdatedAt:"2022\u5e7410\u670813\u65e5",sidebarPosition:2,frontMatter:{id:"swoole\u8fdb\u7a0b\u6811",title:"swoole\u8fdb\u7a0b\u6811",sidebar_position:2,data:"2022\u5e7410\u670813\u65e5",tags:["swoole","process"]},sidebar:"tutorialSidebar",previous:{title:"swoole\u8fdb\u7a0b\u57fa\u7840",permalink:"/dev/Swoole/swoole\u8fdb\u7a0b\u57fa\u7840"},next:{title:"PHP\u591a\u8fdb\u7a0b\u7f16\u7a0b",permalink:"/dev/Swoole/PHP\u591a\u8fdb\u7a0b\u7f16\u7a0b"}},s={},c=[],f={toc:c};function d(e){let{components:n,...t}=e;return(0,o.kt)("wrapper",(0,r.Z)({},f,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"swoole\u8fdb\u7a0b\u6811"},"swoole\u8fdb\u7a0b\u6811"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://wiki.swoole.com/wiki/page/p-server"},"\u6587\u6863\u5730\u5740")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u8fdb\u7a0b\uff1a\u4e00\u4e2a\u7a0b\u5e8f\u542f\u52a8\u4e4b\u540e\u5c31\u662f\u4e00\u4e2a\u8fdb\u7a0b\u4e86\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e5f\u4f1a\u542f\u52a8\u4e00\u4e2a\u4e3b\u7ebf\u7a0b\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u6267\u884c\u8d77\u6765\u3002")),(0,o.kt)("p",null,"\u6587\u6863",(0,o.kt)("inlineCode",{parentName:"p"},"demo")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nuse Swoole\\Server;\n\n// \u521b\u5efa Server \u5bf9\u8c61 \u76d1\u542c 127.0.0.1:9501 \u7aef\u53e3\n$server = new Server('0.0.0.0', 9501);\n$server->set([\n    'reactor_num' => 1,\n    'worker_num' => 2\n]);\n\n// \u76d1\u542c\u8fde\u63a5\u4e8b\u4ef6\n$server->on('Connect', function ($server, $fd) {\n    echo \"client: connected.\\n\";\n});\n\n// \u76d1\u542c\u6570\u636e\u63a5\u6536\u4e8b\u4ef6\n$server->on('Receive', function ($server, $fd, $reactor_id, $data) {\n    echo \"\u6536\u5230\u6570\u636e: \".$data.\"\\r\\n\";\n    $server->send($fd, \"Server\u63a5\u6536\u5230\u4e86\u6570\u636e: {$data}\");\n});\n\n// \u76d1\u542c\u8fde\u63a5\u5173\u95ed\u4e8b\u4ef6\n$server->on('Close', function ($server, $fd) {\n    echo \"client close.\\n\";\n});\n\n// \u542f\u52a8\u670d\u52a1\u5668\n$server->start();\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"[root@jb51 swoole_learn]# netstat -luntp\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name\ntcp        0      0 0.0.0.0:21              0.0.0.0:*               LISTEN      7730/pure-ftpd (SER\ntcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1590/sshd\ntcp        0      0 0.0.0.0:15672           0.0.0.0:*               LISTEN      19207/docker-proxy\ntcp        0      0 0.0.0.0:888             0.0.0.0:*               LISTEN      17824/nginx: worker\ntcp        0      0 0.0.0.0:8888            0.0.0.0:*               LISTEN      3846/python\ntcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      10305/sendmail: acc\ntcp        0      0 0.0.0.0:9501            0.0.0.0:*               LISTEN      16608/php\ntcp        0      0 0.0.0.0:5672            0.0.0.0:*               LISTEN      19227/docker-proxy\ntcp        0      0 127.0.0.1:6379          0.0.0.0:*               LISTEN      15141/redis-server\ntcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      17824/nginx: worker\ntcp6       0      0 :::21                   :::*                    LISTEN      7730/pure-ftpd (SER\ntcp6       0      0 :::22                   :::*                    LISTEN      1590/sshd\ntcp6       0      0 :::15672                :::*                    LISTEN      19213/docker-proxy\ntcp6       0      0 :::5672                 :::*                    LISTEN      19233/docker-proxy\ntcp6       0      0 :::3306                 :::*                    LISTEN      1390/mysqld\nudp        0      0 0.0.0.0:68              0.0.0.0:*                           922/dhclient\nudp        0      0 10.0.16.4:123           0.0.0.0:*                           655/ntpd\nudp        0      0 127.0.0.1:123           0.0.0.0:*                           655/ntpd\nudp6       0      0 fe80::5054:ff:fec3::123 :::*                                655/ntpd\nudp6       0      0 ::1:123                 :::*                                655/ntpd\n[root@jb51 swoole_learn]# pstree -ap | grep php\n  |-php-fpm,24510\n  |   |-php-fpm,22260\n  |   |-php-fpm,24511\n  |   |-php-fpm,24512\n  |   |-php-fpm,24513\n  |   |-php-fpm,24514\n  |   |-php-fpm,24515\n  |   `-php-fpm,27440\n  |   |       `-php,16608 tcp.php\n  |   |           |-php,16609 tcp.php\n  |   |           |   |-php,16611 tcp.php\n  |   |           |   `-php,16612 tcp.php\n  |   |           `-{php},16610\n  |           |-grep,17040 --color=auto php\n")),(0,o.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u8fd0\u884c\u7684\u7a0b\u5e8f\u7684\u8fdb\u7a0bID\u662f",(0,o.kt)("inlineCode",{parentName:"p"},"16608")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"[root@jb51 swoole_learn]# ls -al /proc/16608/fd\n\u603b\u7528\u91cf 0\ndr-x------ 2 root root  0 9\u6708  25 11:53 .\ndr-xr-xr-x 9 root root  0 9\u6708  25 11:53 ..\nlrwx------ 1 root root 64 9\u6708  25 11:54 0 -> /dev/pts/0\nlrwx------ 1 root root 64 9\u6708  25 11:54 1 -> /dev/pts/0\nlrwx------ 1 root root 64 9\u6708  25 11:54 10 -> anon_inode:[eventpoll]\nlrwx------ 1 root root 64 9\u6708  25 11:53 2 -> /dev/pts/0\nlrwx------ 1 root root 64 9\u6708  25 11:54 3 -> socket:[394583124]\nlrwx------ 1 root root 64 9\u6708  25 11:54 4 -> socket:[394583127]\nlrwx------ 1 root root 64 9\u6708  25 11:54 5 -> socket:[394583128]\nlrwx------ 1 root root 64 9\u6708  25 11:54 6 -> socket:[394583129]\nlrwx------ 1 root root 64 9\u6708  25 11:54 7 -> socket:[394583130]\nlrwx------ 1 root root 64 9\u6708  25 11:54 8 -> anon_inode:[eventpoll]\nlrwx------ 1 root root 64 9\u6708  25 11:54 9 -> anon_inode:[signalfd]\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"swoole"),"\u4e3b\u8fdb\u7a0bfd\u76ee\u5f55\u4e0b\u5b58\u5728\u8fd9\u4e48\u4e9b\u4e2a\u6587\u4ef6\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://virusoss.oss-cn-shanghai.aliyuncs.com/images/20220925120215.png",alt:"cat"})),(0,o.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\u5bf9\u5e94 ",(0,o.kt)("inlineCode",{parentName:"p"},"ipv4"),"\u4e0b\u7684\u4e00\u4e9bsocket\u5957\u63a5\u5b57\uff0c\u524d\u9762\u4e00\u90e8\u5206\u662fIP\u5730\u5740\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"local_address rem_address"),"\u662fip\u548c\u7aef\u53e3\u6784\u6210\u7684\u5730\u5740\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"st"),"\u72b6\u6001\u5c31\u662f",(0,o.kt)("inlineCode",{parentName:"p"},"0A"),"\u662f\u5904\u4e8e\u76d1\u542c\u72b6\u6001\u4e2d\uff0c\u5bf9\u5e94\u7684\u5341\u8fdb\u5236\u5c31\u662f10"),(0,o.kt)("p",null,"\u901a\u8baf\u57df\u7c7b\u578b\uff1aIPV4"),(0,o.kt)("p",null,"\u4e00\u822c\u6211\u4eec\u8fde\u63a5\u4f7f\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"AF_INET PF_INET")),(0,o.kt)("p",null,"\u5957\u63a5\u5b57\u7684\u7c7b\u578b\uff1a",(0,o.kt)("inlineCode",{parentName:"p"},"TCP")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"cat /proc/\u8fdb\u7a0bid/net/tcp"),"\uff1a\u6253\u5370\u8fdb\u7a0b\u7684TCP\u8868"),(0,o.kt)("p",null,"\u67e5\u770b",(0,o.kt)("inlineCode",{parentName:"p"},"unix"),"\u57df\u5957\u63a5\u5b57"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"[root@jb51 swoole_learn]# cat /proc/16608/net/unix\nNum       RefCount Protocol Flags    Type St Inode Path\nffff8bd47861aa80: 00000002 00000000 00010000 0001 01 167684 /var/run/docker/libnetwork/562f822555f8.sock\nffff8bd3fa5b7740: 00000002 00000000 00010000 0001 01 310686178 /usr/local/qcloud/YunJing/conf/ydrpc_1\nffff8bd375ea8440: 00000002 00000000 00010000 0001 01 13352 /run/dbus/system_bus_socket\nffff8bd376423740: 00000002 00000000 00010000 0001 01 31044 /run/containerd/containerd.sock.ttrpc\nffff8bd376421540: 00000002 00000000 00010000 0001 01 31046 /run/containerd/containerd.sock\nffff8bd376768cc0: 00000002 00000000 00010000 0001 01 100592 /tmp/mysql.sock\nffff8bd474f65dc0: 00000002 00000000 00010000 0001 01 13642 /var/run/lsm/ipc/simc\nffff8bd375ea8000: 00000002 00000000 00010000 0001 01 13351 @ISCSID_UIP_ABSTRACT_NAMESPACE\nffff8bd376544000: 00000002 00000000 00010000 0001 01 166343 /var/run/docker/metrics.sock\nffff8bd376769dc0: 00000002 00000000 00010000 0001 01 12881 /var/run/lsm/ipc/sim\nffff8bd3786accc0: 00000002 00000000 00010000 0001 01 48318543 /tmp/php-cgi-74.sock\nffff8bd376768880: 00000002 00000000 00010000 0001 01 12903 /var/run/acpid.socket\nffff8bd376420000: 00000002 00000000 00010000 0001 01 11370 /run/lvm/lvmetad.socket\nffff8bd376421dc0: 00000002 00000000 00010000 0001 01 11131 /run/systemd/private\nffff8bd3fa5b5100: 00000002 00000000 00000000 0002 01 310686176 @/usr/local/qcloud/YunJing/conf/ydrpc_3\nffff8bd376422ec0: 00000002 00000000 00010000 0001 01 11174 /run/lvm/lvmpolld.socket\nffff8bd376422a80: 00000002 00000000 00010000 0005 01 11192 /run/udev/control\nffff8bd375ea9dc0: 00000002 00000000 00010000 0001 01 13350 @ISCSIADM_ABSTRACT_NAMESPACE\nffff8bd3f582d980: 00000002 00000000 00010000 0001 01 26050 /var/run/docker.sock\nffff8bd376547300: 00000002 00000000 00010000 0001 01 168907 /run/containerd/s/f3d9541006d85ff69c496c73d8182939cb475898eff4792f03390b069f48352b\nffff8bd3fa5b4440: 00000002 00000000 00010000 0001 01 69324 /var/run/supervisor.sock.19529\nffff8bd478618440: 00000003 00000000 00000000 0002 01  8396 /run/systemd/notify\nffff8bd478618880: 00000002 00000000 00000000 0002 01  8398 /run/systemd/cgroups-agent\nffff8bd478619540: 00000002 00000000 00010000 0001 01  8409 /run/systemd/journal/stdout\nffff8bd478619980: 00000006 00000000 00000000 0002 01  8412 /run/systemd/journal/socket\nffff8bd478619dc0: 00000011 00000000 00000000 0002 01  8414 /dev/log\nffff8bd376420440: 00000002 00000000 00000000 0002 01 11245 /run/systemd/shutdownd\n")),(0,o.kt)("p",null,"\u5185\u5bb9\u6709\u70b9\u591a\uff0c\u5c31\u663e\u793a\u90a3\u4e48\u4e00\u70b9\u3002"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"unix"),"\u901a\u4fe1\u57df\u7684\u4e00\u822c\u8c03\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"socket"),"\u7cfb\u7edf\u51fd\u6570\u7684\u65f6\u5019\u4f20\u5165\u7684\u662f",(0,o.kt)("inlineCode",{parentName:"p"},"AF_LOCAL/AF_UNIX")))}d.isMDXComponent=!0}}]);